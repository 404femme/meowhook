version: '3'
services:
    nebula-bot:
        build: . # This tells compose to build using the Dockerfile
        image: nebula-bot # Optional: names the built image
        container_name: nebula-bot # Sets the container name
        env_file:
            - .env
        restart:
            unless-stopped
            # Remove tty: true as it can cause duplication
        tty: false # ← Disable TTY (no pseudo-terminal)
        stdin_open: false # ← Disable unused stdin
        logging:
            driver: 'json-file' # ← Default, but ensures no duplication
            options:
                max-size: '10m'
                mode: non-blocking # ← Prevents log buffering issues
        networks:
            - nebula-network

    nginx:
        image: nginx:alpine
        container_name: nebula-nginx
        ports:
            - '80:80'
        volumes:
            - ./nginx.conf:/etc/nginx/nginx.conf
            - ./logs/nginx:/var/log/nginx
        restart: unless-stopped
        depends_on:
            - nebula-bot
        networks:
            - nebula-network

networks:
    nebula-network:
        driver: bridge
